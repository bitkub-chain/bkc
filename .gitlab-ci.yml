variables:
  GO_INSTALL_VERSION: go1.20.7

stages:
  - test
  - build

test-job:
  stage: test
  image: golang:latest
  script:
    - make test

build-job:
  image: ubuntu:18.04
  stage: build
  rules:
    - if: $CI_COMMIT_TAG 
  before_script:
    - apt update && apt install curl git make gcc musl-dev python3 python3-pip -y

  script: 
    - curl -L https://golang.org/dl/$GO_INSTALL_VERSION.linux-amd64.tar.gz | tar -C /usr/local -xvz
    - export PATH=$PATH:/usr/local/go/bin
    - make geth
    - tar -cvzf /tmp/geth.tar.gz build/bin/geth

  artifacts:
    paths:
    - build/bin/geth

